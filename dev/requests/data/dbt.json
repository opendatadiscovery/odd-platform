{
  "data_source_oddrn": "//dbt/localhost",
  "items": [
    {
      "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_REVENUE_BY_MONTH",
      "name": "CUSTOMER_REVENUE_BY_MONTH",
      "owner": "TRANSFORMER",
      "metadata": [
        {
          "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetExtension",
          "metadata": {
            "unique_id": "model.acme.customer_revenue_by_month"
          }
        }
      ],
      "type": "VIEW",
      "dataset": {
        "parent_oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE",
        "field_list": [
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_REVENUE_BY_MONTH/columns/DATE_MONTH",
            "name": "DATE_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 1
                }
              }
            ],
            "type": {
              "type": "TYPE_DATETIME",
              "logical_type": "TIMESTAMP_NTZ",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_REVENUE_BY_MONTH/columns/CUSTOMER_ID",
            "name": "CUSTOMER_ID",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 2
                }
              }
            ],
            "type": {
              "type": "TYPE_NUMBER",
              "logical_type": "NUMBER",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_REVENUE_BY_MONTH/columns/MRR",
            "name": "MRR",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 3
                }
              }
            ],
            "type": {
              "type": "TYPE_NUMBER",
              "logical_type": "NUMBER",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_REVENUE_BY_MONTH/columns/IS_ACTIVE",
            "name": "IS_ACTIVE",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 4
                }
              }
            ],
            "type": {
              "type": "TYPE_BOOLEAN",
              "logical_type": "BOOLEAN",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_REVENUE_BY_MONTH/columns/FIRST_ACTIVE_MONTH",
            "name": "FIRST_ACTIVE_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 5
                }
              }
            ],
            "type": {
              "type": "TYPE_DATETIME",
              "logical_type": "TIMESTAMP_NTZ",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_REVENUE_BY_MONTH/columns/LAST_ACTIVE_MONTH",
            "name": "LAST_ACTIVE_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 6
                }
              }
            ],
            "type": {
              "type": "TYPE_DATETIME",
              "logical_type": "TIMESTAMP_NTZ",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_REVENUE_BY_MONTH/columns/IS_FIRST_MONTH",
            "name": "IS_FIRST_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 7
                }
              }
            ],
            "type": {
              "type": "TYPE_BOOLEAN",
              "logical_type": "BOOLEAN",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_REVENUE_BY_MONTH/columns/IS_LAST_MONTH",
            "name": "IS_LAST_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 8
                }
              }
            ],
            "type": {
              "type": "TYPE_BOOLEAN",
              "logical_type": "BOOLEAN",
              "is_nullable": true
            }
          }
        ]
      },
      "data_transformer": {
        "source_code_url": "/Users/claire/fishtown/playbooks/mrr/customer_revenue_by_month.sql",
        "sql": "with subscription_periods as (\n\n    select * from analytics.dbt_claire.subscription_periods\n\n),\n\nmonths as (\n\n    select * from analytics.dbt_claire.util_months\n\n),\n\n-- determine when a given account had its first and last (or most recent) month\ncustomers as (\n\n    select\n        customer_id,\n        date_trunc('month', min(start_date)) as date_month_start,\n        date_trunc('month', max(end_date)) as date_month_end\n\n    from subscription_periods\n\n    group by 1\n\n),\n\n-- create one record per month between a customer's first and last month\n-- (example of a date spine)\ncustomer_months as (\n\n    select\n        customers.customer_id,\n        months.date_month\n\n    from customers\n\n    inner join months\n        -- all months after start date\n        on  months.date_month >= customers.date_month_start\n        -- and before end date\n        and months.date_month < customers.date_month_end\n\n),\n\n-- join the account-month spine to MRR base model, pulling through most recent dates\n-- and plan info for month rows that have no invoices (i.e. churns)\njoined as (\n\n    select\n        customer_months.date_month,\n        customer_months.customer_id,\n        coalesce(subscription_periods.monthly_amount, 0) as mrr\n\n    from customer_months\n\n    left join subscription_periods\n        on customer_months.customer_id = subscription_periods.customer_id\n        -- month is after a subscription start date\n        and customer_months.date_month >= subscription_periods.start_date\n        -- month is before a subscription end date (and handle null case)\n        and (customer_months.date_month < subscription_periods.end_date\n                or subscription_periods.end_date is null)\n\n),\n\nfinal as (\n\n    select\n        date_month,\n        customer_id,\n        mrr,\n\n        mrr > 0 as is_active,\n\n        -- calculate first and last months\n        min(case when is_active then date_month end) over (\n            partition by customer_id\n        ) as first_active_month,\n\n        max(case when is_active then date_month end) over (\n            partition by customer_id\n        ) as last_active_month,\n\n        -- calculate if this record is the first or last month\n        first_active_month = date_month as is_first_month,\n        last_active_month = date_month as is_last_month\n\n    from joined\n\n)\n\nselect * from final",
        "inputs": [
          "//dbt/localhost/databases/analytics/schemas/dbt_claire/tables/util_months",
          "//dbt/localhost/databases/analytics/schemas/dbt_claire/tables/subscription_periods",
          "//aws/glue/databases/test1/tables/test2"
        ],
        "outputs": [
          "//dbt/localhost/databases/analytics/schemas/dbt_claire/tables/customer_churn_month",
          "//dbt/localhost/databases/analytics/schemas/dbt_claire/tables/mrr"
        ]
      }
    },
    {
      "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR",
      "name": "MRR",
      "owner": "TRANSFORMER",
      "metadata": [
        {
          "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetExtension",
          "metadata": {
            "unique_id": "model.acme.mrr"
          }
        }
      ],
      "type": "VIEW",
      "dataset": {
        "parent_oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE",
        "field_list": [
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR/columns/asd",
            "name": "asd",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 2
                }
              }
            ],
            "type": {
              "type": "TYPE_DATETIME",
              "logical_type": "TIMESTAMP_NTZ",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR/columns/CUSTOMER_ID",
            "name": "CUSTOMER_ID",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 3
                }
              }
            ],
            "type": {
              "type": "TYPE_NUMBER",
              "logical_type": "NUMBER",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR/columns/MRR",
            "name": "MRR",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 4
                }
              }
            ],
            "type": {
              "type": "TYPE_NUMBER",
              "logical_type": "FLOAT",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR/columns/IS_ACTIVE",
            "name": "IS_ACTIVE",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 5
                }
              }
            ],
            "type": {
              "type": "TYPE_BOOLEAN",
              "logical_type": "BOOLEAN",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR/columns/FIRST_ACTIVE_MONTH",
            "name": "FIRST_ACTIVE_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 6
                }
              }
            ],
            "type": {
              "type": "TYPE_DATETIME",
              "logical_type": "TIMESTAMP_NTZ",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR/columns/LAST_ACTIVE_MONTH",
            "name": "LAST_ACTIVE_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 7
                }
              }
            ],
            "type": {
              "type": "TYPE_DATETIME",
              "logical_type": "TIMESTAMP_NTZ",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR/columns/IS_FIRST_MONTH",
            "name": "IS_FIRST_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 8
                }
              }
            ],
            "type": {
              "type": "TYPE_BOOLEAN",
              "logical_type": "BOOLEAN",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR/columns/IS_LAST_MONTH",
            "name": "IS_LAST_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 9
                }
              }
            ],
            "type": {
              "type": "TYPE_BOOLEAN",
              "logical_type": "BOOLEAN",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR/columns/PREVIOUS_MONTH_IS_ACTIVE",
            "name": "PREVIOUS_MONTH_IS_ACTIVE",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 10
                }
              }
            ],
            "type": {
              "type": "TYPE_BOOLEAN",
              "logical_type": "BOOLEAN",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR/columns/PREVIOUS_MONTH_MRR",
            "name": "PREVIOUS_MONTH_MRR",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 11
                }
              }
            ],
            "type": {
              "type": "TYPE_NUMBER",
              "logical_type": "FLOAT",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR/columns/MRR_CHANGE",
            "name": "MRR_CHANGE",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 12
                }
              }
            ],
            "type": {
              "type": "TYPE_NUMBER",
              "logical_type": "FLOAT",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR/columns/CHANGE_CATEGORY",
            "name": "CHANGE_CATEGORY",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 13
                }
              }
            ],
            "type": {
              "type": "TYPE_STRING",
              "logical_type": "TEXT",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/MRR/columns/RENEWAL_AMOUNT",
            "name": "RENEWAL_AMOUNT",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 14
                }
              }
            ],
            "type": {
              "type": "TYPE_NUMBER",
              "logical_type": "FLOAT",
              "is_nullable": true
            }
          }
        ]
      },
      "data_transformer": {
        "source_code_url": "/Users/claire/fishtown/playbooks/mrr/mrr.sql",
        "sql": "with unioned as (\n\n    select * from analytics.dbt_claire.customer_revenue_by_month\n\n    union all\n\n    select * from analytics.dbt_claire.customer_churn_month\n\n),\n\n-- get prior month MRR and calculate MRR change\nmrr_with_changes as (\n\n    select\n        *,\n\n        coalesce(\n            lag(is_active) over (partition by customer_id order by date_month),\n            false\n        ) as previous_month_is_active,\n\n        coalesce(\n            lag(mrr) over (partition by customer_id order by date_month),\n            0\n        ) as previous_month_mrr,\n\n        mrr - previous_month_mrr as mrr_change\n\n    from unioned\n\n),\n\n-- classify months as new, churn, reactivation, upgrade, downgrade (or null)\n-- also add an ID column\nfinal as (\n\n    select\n        md5(cast(\n    \n    coalesce(cast(date_month as \n    varchar\n), '') || '-' || coalesce(cast(customer_id as \n    varchar\n), '')\n\n as \n    varchar\n)) as id,\n\n        *,\n\n        case\n            when is_first_month\n                then 'new'\n            when not(is_active) and previous_month_is_active\n                then 'churn'\n            when is_active and not(previous_month_is_active)\n                then 'reactivation'\n            when mrr_change > 0 then 'upgrade'\n            when mrr_change < 0 then 'downgrade'\n        end as change_category,\n\n        least(mrr, previous_month_mrr) as renewal_amount\n\n    from mrr_with_changes\n\n)\n\nselect * from final",
        "inputs": [
          "//dbt/localhost/databases/analytics/schemas/dbt_claire/tables/customer_churn_month",
          "//dbt/localhost/databases/analytics/schemas/dbt_claire/tables/customer_revenue_by_month"
        ],
        "outputs": []
      }
    },
    {
      "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/SUBSCRIPTION_PERIODS",
      "name": "SUBSCRIPTION_PERIODS",
      "owner": "TRANSFORMER",
      "metadata": [
        {
          "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetExtension",
          "metadata": {
            "unique_id": "seed.acme.subscription_periods"
          }
        }
      ],
      "updated_at": "2021-03-04T18:13:00+02:00",
      "created_at": "2021-03-04T18:13:00+02:00",
      "type": "TABLE",
      "dataset": {
        "parent_oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE",
        "rows_number": 121,
        "field_list": [
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/SUBSCRIPTION_PERIODS/columns/SUBSCRIPTION_ID",
            "name": "SUBSCRIPTION_ID",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 1
                }
              }
            ],
            "type": {
              "type": "TYPE_NUMBER",
              "logical_type": "NUMBER",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/SUBSCRIPTION_PERIODS/columns/CUSTOMER_ID",
            "name": "CUSTOMER_ID",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 2
                }
              }
            ],
            "type": {
              "type": "TYPE_NUMBER",
              "logical_type": "NUMBER",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/SUBSCRIPTION_PERIODS/columns/START_DATE",
            "name": "START_DATE",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 3
                }
              }
            ],
            "type": {
              "type": "TYPE_DATETIME",
              "logical_type": "DATE",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/SUBSCRIPTION_PERIODS/columns/END_DATE",
            "name": "END_DATE",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 4
                }
              }
            ],
            "type": {
              "type": "TYPE_DATETIME",
              "logical_type": "DATE",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/SUBSCRIPTION_PERIODS/columns/MONTHLY_AMOUNT",
            "name": "MONTHLY_AMOUNT",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 5
                }
              }
            ],
            "type": {
              "type": "TYPE_NUMBER",
              "logical_type": "NUMBER",
              "is_nullable": true
            }
          }
        ]
      }
    },
    {
      "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_CHURN_MONTH",
      "name": "CUSTOMER_CHURN_MONTH",
      "owner": "TRANSFORMER",
      "metadata": [
        {
          "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetExtension",
          "metadata": {
            "unique_id": "model.acme.customer_churn_month"
          }
        }
      ],
      "type": "VIEW",
      "dataset": {
        "parent_oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE",
        "field_list": [
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_CHURN_MONTH/columns/DATE_MONTH",
            "name": "DATE_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 1
                }
              }
            ],
            "type": {
              "type": "TYPE_DATETIME",
              "logical_type": "DATE",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_CHURN_MONTH/columns/CUSTOMER_ID",
            "name": "CUSTOMER_ID",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 2
                }
              }
            ],
            "type": {
              "type": "TYPE_NUMBER",
              "logical_type": "NUMBER",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_CHURN_MONTH/columns/MRR",
            "name": "MRR",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 3
                }
              }
            ],
            "type": {
              "type": "TYPE_NUMBER",
              "logical_type": "FLOAT",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_CHURN_MONTH/columns/IS_ACTIVE",
            "name": "IS_ACTIVE",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 4
                }
              }
            ],
            "type": {
              "type": "TYPE_BOOLEAN",
              "logical_type": "BOOLEAN",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_CHURN_MONTH/columns/FIRST_ACTIVE_MONTH",
            "name": "FIRST_ACTIVE_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 5
                }
              }
            ],
            "type": {
              "type": "TYPE_DATETIME",
              "logical_type": "TIMESTAMP_NTZ",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_CHURN_MONTH/columns/LAST_ACTIVE_MONTH",
            "name": "LAST_ACTIVE_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 6
                }
              }
            ],
            "type": {
              "type": "TYPE_DATETIME",
              "logical_type": "TIMESTAMP_NTZ",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_CHURN_MONTH/columns/IS_FIRST_MONTH",
            "name": "IS_FIRST_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 7
                }
              }
            ],
            "type": {
              "type": "TYPE_BOOLEAN",
              "logical_type": "BOOLEAN",
              "is_nullable": true
            }
          },
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/CUSTOMER_CHURN_MONTH/columns/IS_LAST_MONTH",
            "name": "IS_LAST_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 8
                }
              }
            ],
            "type": {
              "type": "TYPE_BOOLEAN",
              "logical_type": "BOOLEAN",
              "is_nullable": true
            }
          }
        ]
      },
      "data_transformer": {
        "source_code_url": "/Users/claire/fishtown/playbooks/mrr/customer_churn_month.sql",
        "sql": "with mrr as (\n\n    select * from analytics.dbt_claire.customer_revenue_by_month\n\n),\n\n-- row for month *after* last month of activity\njoined as (\n\n    select\n        dateadd(month, 1, date_month)::date as date_month,\n        customer_id,\n        0::float as mrr,\n        false as is_active,\n        first_active_month,\n        last_active_month,\n        false as is_first_month,\n        false as is_last_month\n\n    from mrr\n\n    where is_last_month\n\n)\n\nselect * from joined",
        "inputs": [
          "//dbt/localhost/databases/analytics/schemas/dbt_claire/tables/customer_revenue_by_month"
        ],
        "outputs": [
          "//dbt/localhost/databases/analytics/schemas/dbt_claire/tables/mrr"
        ]
      }
    },
    {
      "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/UTIL_MONTHS",
      "name": "UTIL_MONTHS",
      "owner": "TRANSFORMER",
      "metadata": [
        {
          "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetExtension",
          "metadata": {
            "unique_id": "model.acme.util_months"
          }
        }
      ],
      "type": "VIEW",
      "dataset": {
        "parent_oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE",
        "field_list": [
          {
            "oddrn": "//dbt/localhost/databases/ANALYTICS/schemas/DBT_CLAIRE/tables/UTIL_MONTHS/columns/DATE_MONTH",
            "name": "DATE_MONTH",
            "owner": "TRANSFORMER",
            "metadata": [
              {
                "schema_url": "https://raw.githubusercontent.com/opendatadiscovery/opendatadiscovery-specification/main/specification/extensions/dbt.json#/definitions/DbtDataSetFieldExtension",
                "metadata": {
                  "index": 1
                }
              }
            ],
            "type": {
              "type": "TYPE_DATETIME",
              "logical_type": "TIMESTAMP_NTZ",
              "is_nullable": true
            }
          }
        ]
      },
      "data_transformer": {
        "source_code_url": "/Users/claire/fishtown/playbooks/mrr/utils/util_months.sql",
        "sql": "\n\n/*\ncall as follows:\n\ndate_spine(\n    \"day\",\n    \"to_date('01/01/2016', 'mm/dd/yyyy')\",\n    \"dateadd(week, 1, current_date)\"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 38\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        month,\n        row_number() over (order by 1) - 1,\n        '2018-01-01'\n        )\n\n\n\n    ) as date_month\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_month <= date_trunc('month', current_date)\n\n)\n\nselect * from filtered\n\n",
        "inputs": [],
        "outputs": [
          "//dbt/localhost/databases/analytics/schemas/dbt_claire/tables/customer_revenue_by_month"
        ]
      }
    }
  ]
}
